<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Reserva de aulas - IES Antonio García Bellido{% endblock %}</title>

    <!-- CSS principal de tu app -->
    <link rel="stylesheet" href="{{ url_for('static', path='styles.css') }}" />

    <!-- ===== CSS del menú (iconos, submenús, transiciones, responsive) ===== -->
    <style>
      :root{
        --menu-bg:#0f172a;
        --submenu-bg:#1e293b;
        --menu-fg:#fff;
        --menu-gap:1.2rem;
        --submenu-radius:8px;
        --easing:cubic-bezier(.22,.61,.36,1);
        --fade-duration:.18s;
        --slide-duration:.22s;
      }

      /* CONTENEDOR DEL MENÚ */
      nav.menu{
        background:var(--menu-bg);
        color:var(--menu-fg);
        padding:.5rem 1rem;
      }

      /* BOTÓN HAMBURGUESA (solo móvil) */
      .menu-toggle{
        display:none;
        align-items:center;
        gap:.5rem;
        background:transparent;
        color:#fff;
        border:1px solid rgba(255,255,255,.25);
        padding:.4rem .6rem;
        border-radius:8px;
        font-size:.95rem;
        cursor:pointer;
      }
      .menu-toggle .icon{width:20px;height:20px;display:block;fill:currentColor;}

      /* LISTA RAÍZ */
      .menu-root{
        list-style:none;
        margin:0;
        padding:0;
        display:flex;
        align-items:center;
        gap:var(--menu-gap);
      }

      .menu-link, .submenu-toggle, .submenu-list a{
        color:var(--menu-fg);
        text-decoration:none;
        font-size:.92rem;
        display:inline-flex;
        align-items:center;
        gap:.45rem;
        line-height:1;
        padding:.25rem .15rem;
      }
      .menu-link:hover, .submenu-toggle:hover, .submenu-list a:hover{
        text-decoration:underline;
        text-underline-offset:2px;
      }

      /* ÍCONOS BÁSICOS */
      .icon{width:18px;height:18px;display:inline-block;fill:currentColor;flex:0 0 18px;}
      .caret{width:14px;height:14px;transform-origin:center;transition:transform .18s var(--easing);opacity:.85}

      /* SUBMENÚS */
      .submenu{position:relative}
      .submenu-list{
        position:absolute;left:0;top:calc(100% + .5rem);
        background:var(--submenu-bg);
        border-radius:var(--submenu-radius);
        padding:.5rem;
        min-width:220px;
        list-style:none;
        margin:0;

        /* Oculto por defecto con transición suave */
        opacity:0; visibility:hidden; transform:translateY(6px);
        transition:
          opacity var(--fade-duration) var(--easing),
          transform var(--slide-duration) var(--easing),
          visibility var(--fade-duration) var(--easing);
        pointer-events:none;
        box-shadow:0 12px 28px rgba(0,0,0,.25);
        z-index:50;
      }
      .submenu-list li{padding:.15rem 0}
      .submenu.open > .submenu-toggle .caret{transform:rotate(180deg)}
      .submenu.open > .submenu-list{
        opacity:1; visibility:visible; transform:translateY(0);
        pointer-events:auto;
      }

      /* ESCRITORIO: abrir también al pasar el ratón */
      @media (hover:hover) and (pointer:fine){
        .submenu:hover > .submenu-list{
          opacity:1; visibility:visible; transform:translateY(0);
          pointer-events:auto;
        }
        .submenu:hover > .submenu-toggle .caret{transform:rotate(180deg)}
      }

      /* RESPONSIVE */
      @media (max-width: 860px){
        nav.menu{
          display:flex; align-items:center; justify-content:space-between;
          gap:1rem;
        }
        .menu-toggle{display:inline-flex;}
        .menu-root{
          position:absolute; left:0; right:0;
          top:60px; /* bajo la barra */
          background:var(--menu-bg);
          flex-direction:column; align-items:flex-start;
          gap:.75rem;
          padding:1rem 1.25rem 1.25rem;
          border-top:1px solid rgba(255,255,255,.12);

          /* cerrado por defecto */
          max-height:0; overflow:hidden;
          opacity:0; visibility:hidden; transform:translateY(-6px);
          transition:
            max-height .26s var(--easing),
            opacity var(--fade-duration) var(--easing),
            transform var(--slide-duration) var(--easing),
            visibility var(--fade-duration) var(--easing);
        }
        .menu-root.open{
          max-height:70vh; opacity:1; visibility:visible; transform:translateY(0);
          overflow:auto;
        }
        .submenu{width:100%}
        .submenu-list{position:static; box-shadow:none; margin:.25rem 0}
      }

      /* HEADER SUPERIOR (tu estilo existente) */
      .topbar{display:flex;justify-content:center;padding:.5rem 1rem;background:#0f172a;color:#f9fafb}
      .topbar-left{display:flex;align-items:center;gap:.75rem;max-width:960px;width:100%}
      .logo-centro{height:48px;width:auto;border-radius:4px;object-fit:contain}
      .topbar-titles{display:flex;flex-direction:column}
      .centro-nombre{font-weight:600;font-size:.95rem}
      .app-nombre{font-size:.8rem;opacity:.8}
      @media (max-width:640px){.logo-centro{height:40px}}
    </style>
  </head>

  <body>
    <!-- ====== CABECERA SUPERIOR ====== -->
    <header class="topbar">
      <div class="topbar-left">
        <img
          src="{{ url_for('static', path='logo.png') }}"
          alt="Logo IES Antonio García Bellido"
          class="logo-centro"
          onerror="this.style.display='none'"
        />
        <div class="topbar-titles">
          <span class="centro-nombre">IES Antonio García Bellido</span>
          <span class="app-nombre">Reserva de aulas</span>
        </div>
      </div>
    </header>

    <!-- ====== MENÚ PRINCIPAL ====== -->
    <nav class="menu" role="navigation" aria-label="Menú principal">
      <!-- Botón hamburguesa (móvil) -->
      <button class="menu-toggle" id="menuToggle" aria-expanded="false" aria-controls="menu-root">
        <!-- icono hamburguesa -->
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z"/>
        </svg>
        <span>Menú</span>
      </button>

      <ul id="menu-root" class="menu-root">
        <!-- Cuadrante -->
        <li>
          <a class="menu-link" href="/web">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M3 5h18v14H3V5zm2 2v10h14V7H5zm2 2h4v3H7V9zm6 0h4v3h-4V9zM7 13h4v3H7v-3zm6 0h4v3h-4v-3z"/>
            </svg>
            <span>Cuadrante</span>
          </a>
        </li>

        <!-- Reservas -->
        <li class="submenu">
          <a href="#" class="submenu-toggle" aria-haspopup="true" aria-expanded="false">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M7 2h10v2H7V2zm12 3H5c-1.1 0-2 .9-2 2v11a4 4 0 004 4h10a4 4 0 004-4V7c0-1.1-.9-2-2-2zm0 13a2 2 0 01-2 2H7a2 2 0 01-2-2V8h14v10zM8 10h5v2H8v-2z"/>
            </svg>
            <span>Reservas</span>
            <svg class="caret" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M7 10l5 5 5-5H7z"/>
            </svg>
          </a>
          <ul class="submenu-list" aria-label="Reservas">
            <li><a href="/web/reservar">Hacer reserva</a></li>
            <li><a href="/web/mis-reservas">Mis reservas</a></li>
          </ul>
        </li>

        <!-- Administración (solo admin) -->
        <li class="submenu" id="menu-admin">
          <a href="#" class="submenu-toggle" aria-haspopup="true" aria-expanded="false">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 1l3 5 6 1-4 4 1 6-6-3-6 3 1-6-4-4 6-1 3-5zm0 4.3L10.6 7.7 7 8.3l2.6 2.5-.6 3.6L12 13l3 .-?"/>
            </svg>
            <span>Administración</span>
            <svg class="caret" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M7 10l5 5 5-5H7z"/>
            </svg>
          </a>
          <ul class="submenu-list" aria-label="Administración">
            <li><a href="/web/usuarios">Usuarios</a></li>
            <li><a href="/web/importar">Importar profesores</a></li>
            <li><a href="/web/estadisticas">Estadísticas</a></li>
          </ul>
        </li>

        <!-- Cuenta -->
        <li class="submenu">
          <a href="#" class="submenu-toggle" aria-haspopup="true" aria-expanded="false">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 12c2.76 0 5-2.24 5-5s-2.24-5-5-5S7 4.24 7 7s2.24 5 5 5zm0 2c-3.33 0-10 1.67-10 5v3h20v-3c0-3.33-6.67-5-10-5z"/>
            </svg>
            <span>Cuenta</span>
            <svg class="caret" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M7 10l5 5 5-5H7z"/>
            </svg>
          </a>
          <ul class="submenu-list" aria-label="Cuenta">
            <li><a href="/web/cambiar-password">Cambiar contraseña</a></li>
            <li><a href="#" onclick="logout(); return false;">Cerrar sesión</a></li>
          </ul>
        </li>
      </ul>
    </nav>

    <!-- ===== CONTENIDO DE CADA PÁGINA ===== -->
    <main class="main-container">
      {% block content %}{% endblock %}
    </main>

    <!-- ===== JS del menú (hover + clic + móvil + accesibilidad) ===== -->
    <script>
      (function(){
        const menuRoot = document.getElementById('menu-root');
        const menuToggle = document.getElementById('menuToggle');

        // Mostrar/ocultar sección de Admin según rol
        const rol = (localStorage.getItem('rol') || '').toLowerCase();
        const adminMenu = document.getElementById('menu-admin');
        if (adminMenu && rol !== 'admin') adminMenu.style.display = 'none';

        // Abrir/cerrar menú móvil
        if(menuToggle){
          menuToggle.addEventListener('click', () => {
            const isOpen = menuRoot.classList.toggle('open');
            menuToggle.setAttribute('aria-expanded', String(isOpen));
            // Cerrar submenús al abrir/cerrar hamburguesa
            document.querySelectorAll('.submenu').forEach(s => {
              s.classList.remove('open');
              const t = s.querySelector('.submenu-toggle');
              if (t) t.setAttribute('aria-expanded','false');
            });
          });
        }

        // Submenús: click para abrir/cerrar (móvil/desktop)
        document.querySelectorAll('.submenu > .submenu-toggle').forEach(toggle => {
          toggle.addEventListener('click', (e) => {
            e.preventDefault();
            const parent = toggle.closest('.submenu');
            const nowOpen = !parent.classList.contains('open');

            // Cerrar todos
            document.querySelectorAll('.submenu.open').forEach(s => {
              s.classList.remove('open');
              const t = s.querySelector('.submenu-toggle');
              if (t) t.setAttribute('aria-expanded','false');
            });

            // Abrir el actual si procede
            if (nowOpen){
              parent.classList.add('open');
              toggle.setAttribute('aria-expanded','true');
            } else {
              toggle.setAttribute('aria-expanded','false');
            }
          });
        });

        // Cerrar submenús al hacer clic fuera del menú
        document.addEventListener('click', (e) => {
          if (!e.target.closest('nav.menu')){
            document.querySelectorAll('.submenu.open').forEach(s => {
              s.classList.remove('open');
              const t = s.querySelector('.submenu-toggle');
              if (t) t.setAttribute('aria-expanded','false');
            });
          }
        });

        // Cerrar con Escape
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape'){
            document.querySelectorAll('.submenu.open').forEach(s => {
              s.classList.remove('open');
              const t = s.querySelector('.submenu-toggle');
              if (t) t.setAttribute('aria-expanded','false');
            });
            if (menuRoot.classList.contains('open')){
              menuRoot.classList.remove('open');
              menuToggle.setAttribute('aria-expanded','false');
            }
          }
        });
      })();

      function logout(){
        localStorage.clear();
        window.location.href = "/login";
      }
    </script>
  </body>
</html>
